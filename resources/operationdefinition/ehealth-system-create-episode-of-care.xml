<OperationDefinition xmlns="http://hl7.org/fhir">
   <id value="-s-create-episode-of-care"/>
   <name value="create-episode-of-care"/>
   <status value="active"/>
   <kind value="operation"/>
   <description value="This operation persists an EpisodeOfCare based on the transient value of an EpisodeOfCare provided in the input.&#xd;&#xa;## Input&#xd;&#xa;The input is a Bundle which must contain exactly one EpisodeOfCare and at least one Provenance resource. All Provenances in the input must have the EpisodeOfCare as target. At least one Provenance must interprete into a 'Privacy-provenance' (see below).&#xd;&#xa;### The EpisodeOfCare resource&#xd;&#xa;The 'id' property of the EpisodeOfCare will be reassigned by the server, but can be referenced by other resources in the same bundle. &#xd;&#xa;The 'managingOrganization' property of the EpisodeOfCare references the GDPR Data Controller (Danish: 'Dataansvarlig').&#xd;&#xa;### The privacy-Provenance resource&#xd;&#xa;A privacy-Provenance is a Provenance resource characterized by having at least two entries in Provenance.policy of which the first indicates the category of registered persons, for which data are transported, stored, or processed as a result of this transaction. Possible values are:&#xd;&#xa;- 'http://ehealth.sundhed.dk/policy/ehealth/patient-data'  (Danish: Person- og patientdata)&#xd;&#xa;- 'http://ehealth.sundhed.dk/policy/ehealth/supplier-data'  (Danish: Leverandørdata)&#xd;&#xa;- 'http://ehealth.sundhed.dk/policy/ehealth/practitioner-data' (Danish: Medarbejderdata)&#xd;&#xa;&#xa;At least one other policy must be stated in Provenance.policy to indicate the legal basis on which data are transported, stored, or processed in the system. Possible values are:&#xd;&#xa;- 'http://ehealth.sundhed.dk/policy/dk/sundhedsloven-0.6.0'&#xd;&#xa;- 'http://ehealth.sundhed.dk/policy/dk/persondataloven-0.6.0'&#xd;&#xa;- 'http://ehealth.sundhed.dk/policy/dk/sikkerhedsbekendtgørelsen-0.6.0'&#xd;&#xa;- 'http://ehealth.sundhed.dk/policy/dk/databeskyttelsesloven-0.6.0'&#xd;&#xa;- 'http://ehealth.sundhed.dk/policy/eu/general-data-protection-regulation-0.6.0'&#xd;&#xa;### Diagnosis referenced Condition resource&#xd;&#xa;For any diagnosis listed, the referenced Condition must be concerning the same Patient as the EpisodeOfCare.&#xd;&#xa;## Output&#xd;&#xa;For valid inputs, the server will create, persist and return a new EpisodeOfCare carrying a server-assigned id.&#xd;&#xa;### The origin-Provenance resource&#xd;&#xa;Whenever an EpisodeOfCare is created, the server automatically creates an 'origin' Provenance resource point to it (in addition to the client-supplied Privacy-Provenance). This Origin-Provenance resource is filled with data from the JWT access token in order to record the origin of the EpisodeOfCare resource. For instance agent.whoReference may point to a resource which is created as a shadow identity from the JWT token, if a matching resource is not already found in the system.&#xd;&#xa;## Examples&#xd;&#xa;### Input&#xd;&#xa;```&#xd;&#xa;{&#xd;&#xa;  'resourceType': 'Bundle',&#xd;&#xa;  'type': 'transaction',&#xd;&#xa;  'entry': [&#xd;&#xa;    {&#xd;&#xa;      'resource': {&#xd;&#xa;        'resourceType': 'Provenance',&#xd;&#xa;        'id': '1',&#xd;&#xa;        'target': [&#xd;&#xa;          {&#xd;&#xa;            'reference': '#2'&#xd;&#xa;          }&#xd;&#xa;        ],&#xd;&#xa;        'recorded': '2019-04-11T12:50:24+02:00',&#xd;&#xa;        'policy': [&#xd;&#xa;          'http://ehealth.sundhed.dk/policy/ehealth/patient-data',&#xd;&#xa;          'http://ehealth.sundhed.dk/policy/eu/general-data-protection-regulation'&#xd;&#xa;        ],&#xd;&#xa;        'agent': [&#xd;&#xa;          {&#xd;&#xa;            'role': [&#xd;&#xa;              {&#xd;&#xa;                'coding': [&#xd;&#xa;                  {&#xd;&#xa;                    'system': 'http://hl7.org/fhir/v3/ParticipationType',&#xd;&#xa;                    'code': 'RESP'&#xd;&#xa;                  }&#xd;&#xa;                ]&#xd;&#xa;              }&#xd;&#xa;            ],&#xd;&#xa;            'whoReference': {&#xd;&#xa;              'reference': 'http://ehealth.sundhed.dk/organization/fhir/Practitioner/321421'&#xd;&#xa;            }&#xd;&#xa;          }&#xd;&#xa;        ]&#xd;&#xa;      },&#xd;&#xa;      'request': {&#xd;&#xa;        'method': 'POST',&#xd;&#xa;        'url': 'Provenance'&#xd;&#xa;      }&#xd;&#xa;    },&#xd;&#xa;    {&#xd;&#xa;      'resource': {&#xd;&#xa;        'resourceType': 'EpisodeOfCare',&#xd;&#xa;        'id': 2,&#xd;&#xa;        'status': 'planned',&#xd;&#xa;        'diagnosis': [&#xd;&#xa;          {&#xd;&#xa;            'condition': {&#xd;&#xa;              'reference': 'http://ehealth.sundhed.dk/careplan/fhir/Condition/1678072'&#xd;&#xa;            }&#xd;&#xa;          }&#xd;&#xa;        ],&#xd;&#xa;        'patient': {&#xd;&#xa;          'reference': 'Patient/4072'&#xd;&#xa;        },&#xd;&#xa;        'managingOrganization': {&#xd;&#xa;          'reference': 'http://ehealth.sundhed.dk/organization/fhir/Organization/71'&#xd;&#xa;        },&#xd;&#xa;        'period': {&#xd;&#xa;          'start': '1970-01-01T01:00:01+01:00',&#xd;&#xa;          'end': '2099-01-01T01:01:40+01:00'&#xd;&#xa;        }&#xd;&#xa;      },&#xd;&#xa;      'request': {&#xd;&#xa;        'method': 'POST',&#xd;&#xa;        'url': 'EpisodeOfCare'&#xd;&#xa;      }&#xd;&#xa;    }&#xd;&#xa;  ]&#xd;&#xa;}&#xd;&#xa;```&#xd;&#xa;### Output&#xd;&#xa;```&#xd;&#xa;{&#xd;&#xa;  'resourceType': 'Bundle',&#xd;&#xa;  'type': 'transaction',&#xd;&#xa;  'entry': [&#xd;&#xa;    {&#xd;&#xa;      'resource': {&#xd;&#xa;        'resourceType': 'Provenance',&#xd;&#xa;        'id': '849028939',&#xd;&#xa;        'target': [&#xd;&#xa;          {&#xd;&#xa;            'reference': ''&#xd;&#xa;          }&#xd;&#xa;        ],&#xd;&#xa;        'recorded': '2019-04-11T12:50:24+02:00',&#xd;&#xa;        'policy': [&#xd;&#xa;          'http://ehealth.sundhed.dk/policy/ehealth/patient-data',&#xd;&#xa;          'http://ehealth.sundhed.dk/policy/eu/general-data-protection-regulation'&#xd;&#xa;        ],&#xd;&#xa;        'agent': [&#xd;&#xa;          {&#xd;&#xa;            'role': [&#xd;&#xa;              {&#xd;&#xa;                'coding': [&#xd;&#xa;                  {&#xd;&#xa;                    'system': 'http://hl7.org/fhir/v3/ParticipationType',&#xd;&#xa;                    'code': 'RESP'&#xd;&#xa;                  }&#xd;&#xa;                ]&#xd;&#xa;              }&#xd;&#xa;            ],&#xd;&#xa;            'whoReference': {&#xd;&#xa;              'reference': 'http://ehealth.sundhed.dk/organization/fhir/Practitioner/321421'&#xd;&#xa;            }&#xd;&#xa;          }&#xd;&#xa;        ]&#xd;&#xa;      },&#xd;&#xa;      'response': {&#xd;&#xa;        'status': '200 OK',&#xd;&#xa;        'location': 'http://ehealth.sundhed.dk/provenance/fhir/Provenance/849028939'&#xd;&#xa;      }&#xd;&#xa;    },&#xd;&#xa;    {&#xd;&#xa;      'resource': {&#xd;&#xa;        'resourceType': 'Provenance',&#xd;&#xa;        'id': '849028940',&#xd;&#xa;        'target': [&#xd;&#xa;          {&#xd;&#xa;            'reference': 'EpisodeOfCare/298359'&#xd;&#xa;          }&#xd;&#xa;        ],&#xd;&#xa;        'recorded': '2019-04-11T17:50:24+02:00',&#xd;&#xa;        'reason': [&#xd;&#xa;          {&#xd;&#xa;            'system': 'http://hl7.org/fhir/v3/ActReason',&#xd;&#xa;            'code': 'PATADMIN'&#xd;&#xa;          }&#xd;&#xa;        ],&#xd;&#xa;        'activity': {&#xd;&#xa;          'system': 'http://hl7.org/fhir/v3/DataOperation',&#xd;&#xa;          'code': 'CREATE'&#xd;&#xa;        },&#xd;&#xa;        'agent': [&#xd;&#xa;          {&#xd;&#xa;            'role': [&#xd;&#xa;              {&#xd;&#xa;                'coding': [&#xd;&#xa;                  {&#xd;&#xa;                    'system': 'http://hl7.org/fhir/v3/ParticipationType',&#xd;&#xa;                    'code': 'ENT'&#xd;&#xa;                  }&#xd;&#xa;                ]&#xd;&#xa;              }&#xd;&#xa;            ],&#xd;&#xa;            'whoReference': {&#xd;&#xa;              'reference': 'http://ehealth.sundhed.dk/organization/fhir/Practitioner/4241545'&#xd;&#xa;            }&#xd;&#xa;          }&#xd;&#xa;        ]&#xd;&#xa;      },&#xd;&#xa;      'response': {&#xd;&#xa;        'status': '200 OK',&#xd;&#xa;        'location': 'http://ehealth.sundhed.dk/provenance/fhir/Provenance/849028940'&#xd;&#xa;      }&#xd;&#xa;    },&#xd;&#xa;    {&#xd;&#xa;      'resource': {&#xd;&#xa;        'resourceType': 'EpisodeOfCare',&#xd;&#xa;        'id': '298359',&#xd;&#xa;        'status': 'planned',&#xd;&#xa;        'diagnosis': [&#xd;&#xa;          {&#xd;&#xa;            'condition': {&#xd;&#xa;              'reference': 'http://ehealth.sundhed.dk/careplan/fhir/Condition/1678072'&#xd;&#xa;            }&#xd;&#xa;          }&#xd;&#xa;        ],&#xd;&#xa;        'patient': {&#xd;&#xa;          'reference': 'Patient/4072'&#xd;&#xa;        },&#xd;&#xa;        'managingOrganization': {&#xd;&#xa;          'reference': 'http://ehealth.sundhed.dk/organization/fhir/Organization/71'&#xd;&#xa;        },&#xd;&#xa;        'period': {&#xd;&#xa;          'start': '1970-01-01T01:00:01+01:00',&#xd;&#xa;          'end': '2099-01-01T01:01:40+01:00'&#xd;&#xa;        }&#xd;&#xa;      },&#xd;&#xa;      'response': {&#xd;&#xa;        'status': '200 OK',&#xd;&#xa;        'location': 'http://ehealth.sundhed.dk/episodeofcare/fhir/EpisodeOfCare/78954'&#xd;&#xa;      }&#xd;&#xa;    }&#xd;&#xa;  ]&#xd;&#xa;}&#xd;&#xa;```&#xd;&#xa;"/>
   <idempotent value="false"/>
   <code value="create-episode-of-care"/>
   <system value="true"/>
   <type value="false"/>
   <instance value="false"/>
   <parameter>
      <name value="episodeOfCareAndProvenances"/>
      <use value="in"/>
      <min value="1"/>
      <max value="1"/>
      <type value="Bundle"/>
   </parameter>
   <parameter>
      <name value="return"/>
      <use value="out"/>
      <min value="0"/>
      <max value="1"/>
      <type value="Bundle"/>
   </parameter>
</OperationDefinition>