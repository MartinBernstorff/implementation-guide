<?xml version="1.0" encoding="utf-8"?>
<StructureDefinition xmlns="http://hl7.org/fhir">
  <id value="ehealth-videoappointment" />
  <url value="http://ehealth.sundhed.dk/fhir/StructureDefinition/ehealth-videoappointment" />
  <name value="ehealth-videoappointment" />
  <title value="eHealth Video Appointment" />
  <status value="draft" />
  <publisher value="ehealth.sundhed.dk" />
  <description value="This profile models an ehealth video appointment. It is only necessary to create one appointment even though it spans more than one participant. Allowed appointment participants are patients, practitioners, relatedpersons, and locations" />
  <fhirVersion value="3.0.1" />
  <kind value="resource" />
  <abstract value="false" />
  <type value="Appointment" />
  <baseDefinition value="http://hl7.org/fhir/StructureDefinition/Appointment" />
  <derivation value="constraint" />
  <differential>
    <element id="Appointment">
      <path value="Appointment" />
      <short value="A booking of a healthcare event among patient(s), practitioner(s), related person(s) and/or device(s) for a specific date/time. This may result in one or more Encounter(s)." />
      <definition value="A booking of a healthcare event among patient(s), practitioner(s), related person(s) and/or device(s) for a specific date/time. This may result in one or more Encounter(s)" />
      <constraint>
        <key value="videoresponsible-2" />
        <severity value="error" />
        <human value="Ensuring that responsible entity is a participating party" />
        <expression value="(extension('http://ehealth.sundhed.dk/fhir/StructureDefinition/ehealth-responsible').value.reference in participant.extension('http://ehealth.sundhed.dk/fhir/StructureDefinition/ehealth-ext-careteam').value.reference) or (extension('http://ehealth.sundhed.dk/fhir/StructureDefinition/ehealth-responsible').value.reference in participant.actor.reference)" />
      </constraint>
    </element>
    <element id="Appointment.extension">
      <path value="Appointment.extension" />
      <slicing>
        <discriminator>
          <type value="value" />
          <path value="url" />
        </discriminator>
        <rules value="open" />
      </slicing>
    </element>
    <element id="Appointment.extension:endMeetingOnEndTime">
      <path value="Appointment.extension" />
      <sliceName value="endMeetingOnEndTime" />
      <max value="1" />
      <type>
        <code value="Extension" />
        <profile value="http://ehealth.sundhed.dk/fhir/StructureDefinition/ehealth-end-meeting-on-end-time" />
      </type>
    </element>
    <element id="Appointment.extension:maxParticipants">
      <path value="Appointment.extension" />
      <sliceName value="maxParticipants" />
      <max value="1" />
      <type>
        <code value="Extension" />
        <profile value="http://ehealth.sundhed.dk/fhir/StructureDefinition/ehealth-max-participants" />
      </type>
    </element>
    <element id="Appointment.extension:meetingURL">
      <path value="Appointment.extension" />
      <sliceName value="meetingURL" />
      <max value="1" />
      <type>
        <code value="Extension" />
        <profile value="http://ehealth.sundhed.dk/fhir/StructureDefinition/ehealth-meeting-url" />
      </type>
    </element>
    <element id="Appointment.extension:vmrUri">
      <path value="Appointment.extension" />
      <sliceName value="vmrUri" />
      <max value="1" />
      <type>
        <code value="Extension" />
        <profile value="http://ehealth.sundhed.dk/fhir/StructureDefinition/ehealth-vmr-uri" />
      </type>
    </element>
    <element id="Appointment.extension:guestPinCode">
      <path value="Appointment.extension" />
      <sliceName value="guestPinCode" />
      <max value="1" />
      <type>
        <code value="Extension" />
        <profile value="http://ehealth.sundhed.dk/fhir/StructureDefinition/ehealth-guest-pin-code" />
      </type>
    </element>
    <element id="Appointment.extension:hostPinCode">
      <path value="Appointment.extension" />
      <sliceName value="hostPinCode" />
      <max value="1" />
      <type>
        <code value="Extension" />
        <profile value="http://ehealth.sundhed.dk/fhir/StructureDefinition/ehealth-host-pin-code" />
      </type>
    </element>
    <element id="Appointment.extension:responsible">
      <path value="Appointment.extension" />
      <sliceName value="responsible" />
      <max value="1" />
      <type>
        <code value="Extension" />
        <profile value="http://ehealth.sundhed.dk/fhir/StructureDefinition/ehealth-responsible" />
      </type>
    </element>
    <element id="Appointment.extension:responsible.value[x]:valueReference">
      <path value="Appointment.extension.value[x]" />
      <sliceName value="valueReference" />
      <type>
        <code value="Reference" />
        <targetProfile value="http://ehealth.sundhed.dk/fhir/StructureDefinition/ehealth-careteam" />
        <aggregation value="referenced" />
      </type>
      <type>
        <code value="Reference" />
        <targetProfile value="http://ehealth.sundhed.dk/fhir/StructureDefinition/ehealth-practitioner" />
        <aggregation value="referenced" />
      </type>
    </element>
    <element id="Appointment.extension:groupId">
      <path value="Appointment.extension" />
      <sliceName value="groupId" />
      <max value="1" />
      <type>
        <code value="Extension" />
        <profile value="http://ehealth.sundhed.dk/fhir/StructureDefinition/ehealth-group-id" />
      </type>
    </element>
    <element id="Appointment.extension:legalBasis">
      <path value="Appointment.extension" />
      <sliceName value="legalBasis" />
      <max value="1" />
      <type>
        <code value="Extension" />
        <profile value="http://ehealth.sundhed.dk/fhir/StructureDefinition/ehealth-legalBasis" />
      </type>
      <meaningWhenMissing value="When the extension value is missing the resource is under unknown jurisdiction" />
      <constraint>
        <key value="governance-2" />
        <severity value="error" />
        <human value="When extension is used a Episode of Care MUST be referenced" />
        <expression value="%resource.supportingInformation.reference.contains('EpisodeOfCare/')" />
      </constraint>
    </element>
    <element id="Appointment.extension:legalBasis.valueCodeableConcept:valueCodeableConcept">
      <path value="Appointment.extension.valueCodeableConcept" />
      <sliceName value="valueCodeableConcept" />
      <binding>
        <strength value="required" />
        <valueSetUri value="http://ehealth.sundhed.dk/vs/jurisdiction" />
      </binding>
    </element>
    <element id="Appointment.extension:releasableResource">
      <path value="Appointment.extension" />
      <sliceName value="releasableResource" />
      <max value="1" />
      <type>
        <code value="Extension" />
        <profile value="http://ehealth.sundhed.dk/fhir/StructureDefinition/ehealth-releasableResource" />
      </type>
    </element>
    <element id="Appointment.identifier">
      <path value="Appointment.identifier" />
      <slicing>
        <discriminator>
          <type value="value" />
          <path value="system" />
        </discriminator>
        <rules value="open" />
      </slicing>
    </element>
    <element id="Appointment.identifier:vdxMeetingId">
      <path value="Appointment.identifier" />
      <sliceName value="vdxMeetingId" />
      <short value="Identifies the FHIR id of the booked VDX meeting resource" />
      <max value="1" />
    </element>
    <element id="Appointment.identifier:vdxMeetingId.system">
      <path value="Appointment.identifier.system" />
      <fixedUri value="http://vdx.medcom.dk/meeting" />
    </element>
    <element id="Appointment.appointmentType">
      <path value="Appointment.appointmentType" />
      <min value="1" />
      <binding>
        <strength value="extensible" />
        <valueSetUri value="http://ehealth.sundhed.dk/vs/appointmenttype-codes" />
      </binding>
    </element>
    <element id="Appointment.reason">
      <path value="Appointment.reason" />
      <min value="1" />
      <binding>
        <strength value="preferred" />
        <valueSetUri value="http://ehealth.sundhed.dk/vs/appointment-reason" />
      </binding>
    </element>
    <element id="Appointment.reason.coding">
      <path value="Appointment.reason.coding" />
      <binding>
        <strength value="required" />
        <valueSetUri value="http://ehealth.sundhed.dk/vs/appointment-reason" />
      </binding>
    </element>
    <element id="Appointment.indication">
      <path value="Appointment.indication" />
      <type>
        <code value="Reference" />
        <targetProfile value="http://hl7.org/fhir/StructureDefinition/Condition" />
        <aggregation value="referenced" />
      </type>
      <type>
        <code value="Reference" />
        <targetProfile value="http://hl7.org/fhir/StructureDefinition/Procedure" />
        <aggregation value="referenced" />
      </type>
    </element>
    <element id="Appointment.description">
      <path value="Appointment.description" />
      <min value="1" />
    </element>
    <element id="Appointment.supportingInformation">
      <path value="Appointment.supportingInformation" />
      <max value="1" />
      <type>
        <code value="Reference" />
        <targetProfile value="http://ehealth.sundhed.dk/fhir/StructureDefinition/ehealth-episodeofcare" />
        <aggregation value="referenced" />
      </type>
      <type>
        <code value="Reference" />
        <targetProfile value="http://ehealth.sundhed.dk/fhir/StructureDefinition/ehealth-careplan" />
        <aggregation value="referenced" />
      </type>
    </element>
    <element id="Appointment.start">
      <path value="Appointment.start" />
      <min value="1" />
    </element>
    <element id="Appointment.end">
      <path value="Appointment.end" />
      <min value="1" />
    </element>
    <element id="Appointment.slot">
      <path value="Appointment.slot" />
      <type>
        <code value="Reference" />
        <targetProfile value="http://hl7.org/fhir/StructureDefinition/Slot" />
        <aggregation value="referenced" />
      </type>
    </element>
    <element id="Appointment.incomingReferral">
      <path value="Appointment.incomingReferral" />
      <type>
        <code value="Reference" />
        <targetProfile value="http://hl7.org/fhir/StructureDefinition/ReferralRequest" />
        <aggregation value="referenced" />
      </type>
    </element>
    <element id="Appointment.participant">
      <path value="Appointment.participant" />
      <min value="2" />
    </element>
    <element id="Appointment.participant.extension">
      <path value="Appointment.participant.extension" />
      <slicing>
        <discriminator>
          <type value="value" />
          <path value="url" />
        </discriminator>
        <rules value="open" />
      </slicing>
    </element>
    <element id="Appointment.participant.extension:careteam">
      <path value="Appointment.participant.extension" />
      <sliceName value="careteam" />
      <max value="1" />
      <type>
        <code value="Extension" />
        <profile value="http://ehealth.sundhed.dk/fhir/StructureDefinition/ehealth-ext-careteam" />
      </type>
    </element>
    <element id="Appointment.participant.actor">
      <path value="Appointment.participant.actor" />
      <type>
        <code value="Reference" />
        <targetProfile value="http://ehealth.sundhed.dk/fhir/StructureDefinition/ehealth-patient" />
        <aggregation value="referenced" />
      </type>
      <type>
        <code value="Reference" />
        <targetProfile value="http://ehealth.sundhed.dk/fhir/StructureDefinition/ehealth-practitioner" />
        <aggregation value="referenced" />
      </type>
      <type>
        <code value="Reference" />
        <targetProfile value="http://ehealth.sundhed.dk/fhir/StructureDefinition/ehealth-relatedperson" />
        <aggregation value="referenced" />
      </type>
      <type>
        <code value="Reference" />
        <targetProfile value="http://hl7.org/fhir/StructureDefinition/Location" />
        <aggregation value="contained" />
      </type>
    </element>
  </differential>
</StructureDefinition>